function globalsave(e,t,i,o){var r=Ti.Network.createHTTPClient({onerror:function(e){Ti.API.debug(e.error),alert(e.error)},timeout:1e3});r.onload=function(){var e=JSON.parse(this.responseText);if(Ti.API.info(this.responseText),"Saved!"==e.message){o.id=e.id;var t=Alloy.createModel(i,o);t.save(),Alloy.Collections[i].fetch()}else alert("There was an error in saving the "+i+"record.")},r.open("POST",e),r.send(t)}function globalserverdelete(e,t){var i=Ti.Network.createHTTPClient({onerror:function(e){Ti.API.debug(e.error),alert("There was an error during the connection.  Want to try again?")},timeout:1e3});i.open("POST",Alloy.Globals.BASEURL+e+"/mobiledelete.json"),Ti.API.info(Alloy.Globals.BASEURL+e+"/mobiledelete"),i.send({id:t}),i.onload=function(){var i=JSON.parse(this.responseText);Ti.API.info(i);var o=Ti.Database.open("_alloy_");o.execute("DELETE FROM "+e+" WHERE id = ?",t),o.close()}}function globaldelete(e,t,i,o,r,n,a){if(""!=t)if(a.deleteRow(e.index),Alloy.Globals.RELATIONSHIP[i][n]!==void 0)globalopenDetail(e,Alloy.Globals.RELATIONSHIP[i].sModelname);else{var l=Ti.Database.open("_alloy_"),s=Alloy.Globals.RELATIONSHIP[n].related[i].manytomanytblname,d=l.execute("SELECT id FROM "+s+" WHERE "+Alloy.Globals.RELATIONSHIP[n].singlename+"_id = ? AND "+o+"_id = ?",r,e.rowData.dataId);Ti.API.info("SELECT id FROM "+s+" WHERE "+Alloy.Globals.RELATIONSHIP[n].singlename+"_id = "+r+" AND "+o+"_id = "+e.rowData.dataId),1==d.getRowCount()?globalserverdelete(s,d.fieldByName("id")):alert("There is an error in your records. There are "+d.getRowCount()+" records"),l.close()}else a.deleteRow(e.index),globalserverdelete(Alloy.Globals.RELATIONSHIP[i].tblname,e.rowData.dataId)}function globalgetrecords(e,t){if(Ti.App.Properties.hasProperty(e+"seeded")){var i=!1;if(0==i){var o=[],r=Ti.Network.createHTTPClient({onerror:function(t){Ti.API.debug(t.error),alert("There was an error during the connection to get "+e+" records")},timeout:1e3});r.open("POST",Alloy.Globals.BASEURL+e+"/mobileindex.json"),r.send({token:Ti.App.Properties.getString("token")}),r.onload=function(){Ti.API.info(this.responseText);var i=JSON.parse(this.responseText);0==i.length&&($.table.headerTitle="The database row is empty");for(var r=i,n=0,a=r.length;a>n;n++)o.push(r[n][t]);Alloy.Collections[t].reset(o),Alloy.Collections[t].each(function(e){e.save()});var l=Alloy.Collections[t];l.fetch(),Ti.App.Properties.setString(e+"seeded","yuppers")}}}else{var o=[],r=Ti.Network.createHTTPClient({onerror:function(t){Ti.API.debug(t.error),alert("There was an error during the connection to get "+e+" records")},timeout:1e3});r.open("POST",Alloy.Globals.BASEURL+e+"/mobileindex.json"),r.send({token:Ti.App.Properties.getString("token")}),r.onload=function(){Ti.API.info(this.responseText);var i=JSON.parse(this.responseText);0==i.length&&($.table.headerTitle="The database row is empty");for(var r=i,n=0,a=r.length;a>n;n++)o.push(r[n][t]);Alloy.Collections[t].reset(o),Alloy.Collections[t].each(function(e){e.save()});var l=Alloy.Collections[t];l.fetch(),Ti.App.Properties.setString(e+"seeded","yuppers")}}var n=Alloy.Collections[t];n.fetch()}function globalopenChild(e,t,i,o,r){if(1==o){var n={cancel:t.length-1,options:t,title:"Which Sub Records?"},a=Ti.UI.createOptionDialog(n);a.addEventListener("click",function(i){if(i.index!=t.length-1){var o="related",n="",a=!1;t[i.index].indexOf(o)>=0?(n=t[i.index].replace("related ",""),a=!0):n=t[i.index];var l=Alloy.createController(n,{parentTab:Alloy.Globals.tabGroup.getActiveTab(),dataId:e.rowData.dataId,manytomanyaddscreen:r,related:a}),s=l.getView(),d=Alloy.Globals.tabGroup.getActiveTab();d.open(s)}}),a.show()}else{var l="related",s="",d=!1;i.indexOf(l)>=0?(s=i.replace("related ",""),d=!0):s=i;var c=Alloy.createController(s,{parentTab:Alloy.Globals.tabGroup.getActiveTab(),dataId:e.rowData.dataId,manytomanyaddscreen:r,related:d}),u=c.getView(),_=Alloy.Globals.tabGroup.getActiveTab();_.open(u)}}function globaledittable(e,t){"Edit"==e.source.title?(t.editable=!1,t.editing=!0,t.editing=!1,t.editing=!0,t.moving=!0,e.source.title="Done"):(t.editable=!0,t.editing=!1,t.moving=!1,e.source.title="Edit")}function globalopenAddItem(e,t,i,o,r,n){if(""!=e)if(1==t){Ti.App.addEventListener("changefield",function(e){var t=Ti.Database.open("_alloy_"),a=Alloy.Globals.RELATIONSHIP[i].related[r].manytomanytblname;t.execute("INSERT INTO "+a+" ("+Alloy.Globals.RELATIONSHIP[r].singlename+"_id, "+o+"_id) Values(?,?)",n,e.value),t.close()});var a=Alloy.createController(i+"chooser").getView();a.open()}else{var a=Alloy.createController(i+"Add").getView();a.open()}else{var a=Alloy.createController(i+"Add").getView();a.open()}}function globalopenDetail(e,t){var i=Alloy.Collections[t],o=Alloy.createController("detail",{parentTab:Alloy.Globals.tabGroup.getActiveTab(),dataId:e.rowData.dataId,model:i.get(e.rowData.dataId)}),r=o.getView(),n=Alloy.Globals.tabGroup.getActiveTab();n.open(r)}var Alloy=require("alloy"),_=Alloy._,Backbone=Alloy.Backbone;Alloy.Globals.BASEURL="http://www.derekstearns.com/sampleapp/",Alloy.Globals.RELATIONSHIP={workers:{Modelname:"Workers",modelname:"workers",singlename:"worker",tblname:"workers",sModelname:"Worker",places:{relation:"BT",tblname:"places",Modelname:"Places",modelname:"Places",sModelname:"Place"},related:{widgets:{manytomanytblname:"workers_widgets",manytomanyModelname:"WorkersWidgets",manytomanymodelname:"workerswidgets"}}},widgets:{Modelname:"Widgets",modelname:"widgets",singlename:"widget",tblname:"widgets",sModelname:"Widget",places:{relation:"HM",tblname:"places",Modelname:"Places",singlename:"place",sModelname:"Place"},related:{workers:{manytomanytblname:"workers_widgets",manytomanyModelname:"WorkersWidgets",manytomanymodelname:"workerswidgets"}}},places:{Modelname:"Places",modelname:"places",singlename:"place",tblname:"places",sModelname:"Place",widgets:{relation:"BT",tblname:"widgets",Modelname:"Widgets",modelname:"widgets",sModelname:"Widget"},workers:{relation:"HM",tblname:"workers",Modelname:"Workers",modelname:"workers",sModelname:"Worker"}}},1==Alloy.Globals.LocalDB&&(Alloy.Collections.Widgets=Alloy.createCollection("widget"),Alloy.Collections.Workers=Alloy.createCollection("worker"),Alloy.Collections.Places=Alloy.createCollection("place")),Alloy.Globals.LocalDB=!0,Alloy.Globals.SyncAtInstall=!1,Alloy.Globals.AutoSync=!0,Alloy.Globals.SyncFreqOpt="RUNTIME",Alloy.Globals.AllowDynAutoSync=!0,Alloy.Globals.DefaultSyncFreqOpt=Alloy.Globals.SyncFreqOpt,Alloy.Globals.AllowDynSync=!0,Alloy.Globals.configureLogin=!0,Alloy.Globals.testchildren=3,Alloy.Globals.Styles={TableViewRow:{height:45}},Alloy.createController("index");