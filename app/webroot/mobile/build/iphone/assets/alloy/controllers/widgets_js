function Controller(){function e(){e.opts||{};for(var t=s.models,i=t.length,n=[],r=0;i>r;r++){var a=t[r];a.__transform={};var l=Ti.UI.createTableViewRow({dataId:a.__transform.id!==void 0?a.__transform.id:a.get("id"),title:a.__transform.name!==void 0?a.__transform.name:a.get("name")});n.push(l)}o.__views.tblview.setData(n)}function t(e){globaldelete(e,w,c,d,y,f,o.tblview),Ti.API.info("e_id:"+e.rowData.dataId)}function i(e){if(""!=w){var t=Alloy.Globals.RELATIONSHIP[h],i="",n="";if(Ti.API.info(t),Alloy.Globals.RELATIONSHIP[h][f]!==void 0)n=Alloy.Globals.RELATIONSHIP[h].sModelname,globalopenDetail(e,n);else{i=Alloy.Globals.RELATIONSHIP[h].related[f].manytomanytblname,n=Alloy.Globals.RELATIONSHIP[h].related[f].manytomanyModelname;var o=Ti.Database.open("_alloy_"),r=o.execute("SELECT id FROM "+i+" WHERE "+Alloy.Globals.RELATIONSHIP[f].singlename+"_id = ? AND "+d+"_id = ?",y,e.rowData.dataId);if(1==r.getRowCount()){var a=Alloy.Collections[n];a.fetch();var s=Alloy.createController(i+"Edit",{parentTab:Alloy.Globals.tabGroup.getActiveTab(),dataId:r.fieldByName("id"),model:a.get(r.fieldByName("id"))}),l=s.getView(),c=Alloy.Globals.tabGroup.getActiveTab();c.open(l),o.close()}else alert("Error: you have duplicate records!")}}else globalopenDetail(e,u)}function n(e){var t=I.models.length;Ti.API.info(t);var i=[],n=Ti.Network.createHTTPClient({onerror:function(e){Ti.API.debug(e.error),alert("There was an error during the connection")},timeout:1e3}),r=t/20+1;n.open("GET",Alloy.Globals.BASEURL+c+"/page:"+(""+r)),n.send(),n.onload=function(){var n=JSON.parse(this.responseText);0==n.length&&(o.table.headerTitle="The database row is empty");for(var r=n,a=0,s=r.length;s>a;a++)i.push(r[a][u]);Alloy.Collections[u].reset(i),Alloy.Collections[u].each(function(e){e.save()});var l=Alloy.Collections[u];l.fetch({data:{offset:t},add:!0,silent:!0,success:function(i){Ti.API.info("successful here"),i.models.length===t?e.done():e.success()},error:e.error})}}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="widgets",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var o=this,r={},a={};Alloy.Collections.instance("Widget"),o.__views.tblviewWindow=Ti.UI.createWindow({backgroundColor:"white",id:"tblviewWindow",fullscreen:"false"}),o.__views.tblviewWindow&&o.addTopLevelView(o.__views.tblviewWindow),o.__views.editme=Ti.UI.createButton({top:10,title:"Edit",id:"editme"}),o.__views.tblviewWindow.rightNavButton=o.__views.editme,o.__views.activityIndicator=Ti.UI.createActivityIndicator({height:Ti.UI.SIZE,width:Ti.UI.SIZE,top:20,style:Ti.UI.iPhone.ActivityIndicatorStyle.DARK,id:"activityIndicator"}),o.__views.tblviewWindow.add(o.__views.activityIndicator),o.__views.labelNoRecords=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:"#000",visible:!1,top:20,id:"labelNoRecords"}),o.__views.tblviewWindow.add(o.__views.labelNoRecords),o.__views.__alloyId24=Ti.UI.createSearchBar({id:"__alloyId24"}),o.__views.tblview=Ti.UI.createTableView({height:Ti.UI.SIZE,top:0,search:o.__views.__alloyId24,searchHidden:"true",id:"tblview",editable:"true",filterAttribute:"title"}),o.__views.tblviewWindow.add(o.__views.tblview),o.__views.is=Alloy.createWidget("nl.fokkezb.infiniteScroll","widget",{id:"is",__parentSymbol:o.__views.tblview}),o.__views.is.setParent(o.__views.tblview),n?o.__views.is.on("end",n):a["$.__views.is!end!myLoader"]=!0;var s=Alloy.Collections.Widget||Widget;s.on("fetch destroy change add remove reset",e);var l=[];o.__views.camera=Ti.UI.createButton({top:10,id:"camera",systemButton:Ti.UI.iPhone.SystemButton.CAMERA}),l.push(o.__views.camera),o.__views.__alloyId33=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE}),l.push(o.__views.__alloyId33),o.__views.refresh=Ti.UI.createButton({top:10,id:"refresh",systemButton:Ti.UI.iPhone.SystemButton.REFRESH}),l.push(o.__views.refresh),o.__views.__alloyId34=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE}),l.push(o.__views.__alloyId34),o.__views.addbtn=Ti.UI.createButton({top:10,id:"addbtn",systemButton:Ti.UI.iPhone.SystemButton.ADD}),l.push(o.__views.addbtn),o.__views.__alloyId30=Ti.UI.iOS.createToolbar({items:l,bottom:"0",borderTop:"true",borderBottom:"false",id:"__alloyId30"}),o.__views.tblviewWindow.add(o.__views.__alloyId30),r.destroy=function(){s.off("fetch destroy change add remove reset",e)},_.extend(o,o.__views);var d="widget",c="widgets",u="Widget",h="widgets",v=["related workers","places","Cancel"],p=!0,g="",m=arguments[0]||{},w=m.parentTab||"",f=m.manytomanyaddscreen,T=m.related,y=0===m.dataId||m.dataId>0?m.dataId:"";o.addbtn.addEventListener("click",function(){globalopenAddItem(w,T,c,d,f,y)}),o.refresh.addEventListener("click",function(){globalgetrecords(c,u)}),o.editme.addEventListener("click",function(e){globaledittable(e,o.tblview)}),o.tblview.addEventListener("delete",function(e){t(e)}),o.tblview.addEventListener("longpress",function(e){globalopenDetail(e,u)});var I=Alloy.Collections[u];I.fetch(),globalgetrecords(c,u),o.tblview.addEventListener("click",function(e){""!=w?i(e):globalopenChild(e,v,g,p,c,w)}),o.tblviewWindow.addEventListener("focus",function(){if(""!=w){Ti.API.info("args not empty!");var e=Alloy.Collections[u],t=Ti.Database.open("_alloy_");if(1==T){var i=Alloy.Globals.RELATIONSHIP[c].related[f].manytomanytblname,n=t.execute("SELECT "+d+"_id FROM "+i+" WHERE "+Alloy.Globals.RELATIONSHIP[f].singlename+"_id = ?",y);if(0!=n.rowCount){for(var r="";n.isValidRow();)r=r+n.fieldByName(d+"_id")+",",n.next();t.close(),r=r.substring(0,r.length-1)+")",e.fetch({query:"SELECT * FROM "+h+" WHERE id IN ("+r})}else e.fetch({query:"SELECT * from "+i+" WHERE id = 0;"}),o.tblview.headerTitle="The database row is empty"}else e.fetch({query:"SELECT * FROM "+h+" WHERE "+Alloy.Globals.RELATIONSHIP[f].singlename+"_id ="+y})}else{Ti.API.info("args empty!");var e=Alloy.Collections[u];e.fetch()}}),a["$.__views.is!end!myLoader"]&&o.__views.is.on("end",n),_.extend(o,r)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;