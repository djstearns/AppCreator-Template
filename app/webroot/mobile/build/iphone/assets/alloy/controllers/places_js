function Controller(){function e(){e.opts||{};for(var t=a.models,i=t.length,r=[],o=0;i>o;o++){var s=t[o];s.__transform={};var l=Ti.UI.createTableViewRow({dataId:s.__transform.id!==void 0?s.__transform.id:s.get("id"),title:s.__transform.name!==void 0?s.__transform.name:s.get("name")});r.push(l)}n.__views.tblview.setData(r)}function t(e){globaldelete(e,f,c,d,y,w,n.tblview),Ti.API.info("e_id:"+e.rowData.dataId)}function i(e){if(""!=f){var t=Alloy.Globals.RELATIONSHIP[h],i="",r="";if(Ti.API.info(t),Alloy.Globals.RELATIONSHIP[h][w]!==void 0)r=Alloy.Globals.RELATIONSHIP[h].sModelname,globalopenDetail(e,r);else{i=Alloy.Globals.RELATIONSHIP[h].related[w].manytomanytblname,r=Alloy.Globals.RELATIONSHIP[h].related[w].manytomanyModelname;var n=Ti.Database.open("_alloy_"),o=n.execute("SELECT id FROM "+i+" WHERE "+Alloy.Globals.RELATIONSHIP[w].singlename+"_id = ? AND "+d+"_id = ?",y,e.rowData.dataId);if(1==o.getRowCount()){var s=Alloy.Collections[r];s.fetch();var a=Alloy.createController(i+"Edit",{parentTab:Alloy.Globals.tabGroup.getActiveTab(),dataId:o.fieldByName("id"),model:s.get(o.fieldByName("id"))}),l=a.getView(),c=Alloy.Globals.tabGroup.getActiveTab();c.open(l),n.close()}else alert("Error: you have duplicate records!")}}else globalopenDetail(e,u)}function r(e){var t=I.models.length;Ti.API.info(t);var i=[],r=Ti.Network.createHTTPClient({onerror:function(e){Ti.API.debug(e.error),alert("There was an error during the connection")},timeout:1e3}),o=t/20+1;r.open("GET",Alloy.Globals.BASEURL+c+"/page:"+(""+o)),r.send(),r.onload=function(){var r=JSON.parse(this.responseText);0==r.length&&(n.table.headerTitle="The database row is empty");for(var o=r,s=0,a=o.length;a>s;s++)i.push(o[s][u]);Alloy.Collections[u].reset(i),Alloy.Collections[u].each(function(e){e.save()});var l=Alloy.Collections[u];l.fetch({data:{offset:t},add:!0,silent:!0,success:function(i){Ti.API.info("successful here"),i.models.length===t?e.done():e.success()},error:e.error})}}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="places",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var n=this,o={},s={};Alloy.Collections.instance("Place"),n.__views.tblviewWindow=Ti.UI.createWindow({backgroundColor:"white",id:"tblviewWindow"}),n.__views.tblviewWindow&&n.addTopLevelView(n.__views.tblviewWindow),n.__views.editme=Ti.UI.createButton({top:10,title:"Edit",id:"editme"}),n.__views.tblviewWindow.rightNavButton=n.__views.editme,n.__views.activityIndicator=Ti.UI.createActivityIndicator({height:Ti.UI.SIZE,width:Ti.UI.SIZE,top:20,style:Ti.UI.iPhone.ActivityIndicatorStyle.DARK,id:"activityIndicator"}),n.__views.tblviewWindow.add(n.__views.activityIndicator),n.__views.labelNoRecords=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:"#000",visible:!1,top:20,id:"labelNoRecords"}),n.__views.tblviewWindow.add(n.__views.labelNoRecords),n.__views.__alloyId9=Ti.UI.createSearchBar({id:"__alloyId9"}),n.__views.tblview=Ti.UI.createTableView({height:Ti.UI.SIZE,top:0,search:n.__views.__alloyId9,searchHidden:"true",id:"tblview",moveable:"true",editable:"true",filterAttribute:"title"}),n.__views.tblviewWindow.add(n.__views.tblview),n.__views.is=Alloy.createWidget("nl.fokkezb.infiniteScroll","widget",{id:"is",__parentSymbol:n.__views.tblview}),n.__views.is.setParent(n.__views.tblview),r?n.__views.is.on("end",r):s["$.__views.is!end!myLoader"]=!0;var a=Alloy.Collections.Place||Place;a.on("fetch destroy change add remove reset",e);var l=[];n.__views.camera=Ti.UI.createButton({top:10,id:"camera",systemButton:Ti.UI.iPhone.SystemButton.CAMERA}),l.push(n.__views.camera),n.__views.__alloyId18=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE}),l.push(n.__views.__alloyId18),n.__views.refresh=Ti.UI.createButton({top:10,id:"refresh",systemButton:Ti.UI.iPhone.SystemButton.REFRESH}),l.push(n.__views.refresh),n.__views.__alloyId19=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE}),l.push(n.__views.__alloyId19),n.__views.addbtn=Ti.UI.createButton({top:10,id:"addbtn",systemButton:Ti.UI.iPhone.SystemButton.ADD}),l.push(n.__views.addbtn),n.__views.__alloyId15=Ti.UI.iOS.createToolbar({items:l,bottom:"0",borderTop:"true",borderBottom:"false",id:"__alloyId15"}),n.__views.tblviewWindow.add(n.__views.__alloyId15),o.destroy=function(){a.off("fetch destroy change add remove reset",e)},_.extend(n,n.__views);var d="place",c="places",u="Place",h="places",p="",g=!1,v="workers",m=arguments[0]||{},f=m.parentTab||"",w=m.manytomanyaddscreen,T=m.related,y=0===m.dataId||m.dataId>0?m.dataId:"";n.addbtn.addEventListener("click",function(){globalopenAddItem(f,T,c,d,w,y)}),n.refresh.addEventListener("click",function(){globalgetrecords(c,u)}),n.editme.addEventListener("click",function(e){globaledittable(e,n.tblview)}),n.tblview.addEventListener("delete",function(e){t(e)}),n.tblview.addEventListener("longpress",function(e){globalopenDetail(e,u)});var I=Alloy.Collections[u];I.fetch(),globalgetrecords(c,u),n.tblview.addEventListener("click",function(e){""!=f?i(e):globalopenChild(e,p,v,g,c,f)}),n.tblviewWindow.addEventListener("focus",function(){if(""!=f){Ti.API.info("args not empty!");var e=Alloy.Collections[u],t=Ti.Database.open("_alloy_");if(1==T){var i=Alloy.Globals.RELATIONSHIP[c].related[w].manytomanytblname,r=t.execute("SELECT "+d+"_id FROM "+i+" WHERE "+Alloy.Globals.RELATIONSHIP[w].singlename+"_id = ?",y);if(0!=r.rowCount){for(var o="";r.isValidRow();)o=o+r.fieldByName(d+"_id")+",",r.next();t.close(),o=o.substring(0,o.length-1)+")",e.fetch({query:"SELECT * FROM "+h+" WHERE id IN ("+o})}else e.fetch({query:"SELECT * from "+i+" WHERE id = 0;"}),n.tblview.headerTitle="The database row is empty"}else e.fetch({query:"SELECT * FROM "+h+" WHERE "+Alloy.Globals.RELATIONSHIP[w].singlename+"_id ="+y})}else{Ti.API.info("args empty!");var e=Alloy.Collections[u];e.fetch()}}),s["$.__views.is!end!myLoader"]&&n.__views.is.on("end",r),_.extend(n,o)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;